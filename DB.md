# PostgreSQL과 RDB

## RDB (Relational Database) 란?

관계형 데이터 모델이 기초를 둔 데이터 베이스로, 키(Key)와 값(Value)들의 관계를 테이블화 시킨 데이터 베이스를 의미합니다.

- Relation

  Entity, Table과 대응되는 용어로 속성과 튜플로 구성되어있습니다.

  - Attribute

    Entity를 구성하는 **논리적 단위**로 파일 구조상에서 데이터 항목 내지는 데이터 필드를 의미하며 테이블에서는 **하나의 컬럼**에 대응합니다. 속성의 수는 Degree 또는 차수로 표현하기도 합니다. (ex. 이름, 주소, 연락처..)

    - Domain

      한 개의 속성(Attribute)가 가질 수 있는 값들의 집합을 의미합니다. 예를 들어 성별이라는 속성이 있는 경우 도메인은 남, 여가 됩니다.

  - Tuple

    기수, 대응수라고도 불리며 테이블에 있는 **각각의 행**을 의미합니다. 속성의 모임이며, 파일 구조에서는 **레코드와 같은 의미**로 쓰입니다. (ex. 홍길동 / 서울시 동작구 / 010-1234-1234)



### 관계형 데이터 모델 (Relational Data Model)

모든 데이터를 2차원 테이블 형태로 표현하는 데이터 모델



- 데이터 독립성이 높다
- 고수준의 **데이터 조작 언어**를 사용하여 결합, 제약, 투영 등 관계 조작에 의한 비약전인 표현 능력 향상
- 관계 조작에 의해 자유로운 구조 변경 가능



### 데이터 베이스 언어 (Query)

- DDL - 정의어 (Data Definition Language)

  데이터 베이스를 구축하거나 수정하는데 사용되며, 데이터 베이스의 구조와 데이터의 형식, 접근 방식을 정의하는 언어입니다. 

  - CREATE
  - ALTER
  - DROP
  - RENAME
  - TRUNCATE

- DML - 조작어 (Data Manipulation Language)

  사용자 DBMS와 응용프로그램 간의 inteface를 제공하며 사용자가 데이터를 직접 처리할 수 있게 하는 명령어로 데이터 베이스의 Sub Language 역할을 합니다.

  - SELECT
  - INSERT
  - UPDATE
  - DELETE

- DCL - 제어어 (Data control Language)

  데이터 베이스에 접근하고 객체들을 사용하도록 권한을 주고 회수하는 명령어

  - GRANT
  - REVOKE

- TCL - 트렌젝션 제어어 (Transaction Control Language)

  논리적인 단위의 작업(트렌젝션)을 묶어서 제어하는 명령어

  - COMMIT
  - ROLLBACK
  - SAVEPOINT



## RDBMS(Relational Database Management System) 이란?

관계형 데이터 베이스를 생성, 수정 관리해줄 수 있는 도구



- 모든 데이터를 2차원 **테이블**로 표현
  - row(record, tuple)
  -  column(field, item)
  - 하나의 테이블은 여러개의 컬럼으로 구성
  - 중복 정보는 최소화
- ER 모델링 (Entity Relationship)
  - 테이블은 Entity(기본)와 Relationship(유도) 테이블로 구분
- 여러 테이블을 합쳐 큰 테이블을 생성(JOIN)해서 필요 정보를 찾아냄





## 스키마(Schema)

데이터 Entity(개체), Attribute(속성), Relationship(관계)와 같은 데이터 베이스 구조와 기타 제약 조건에 대한 명세를 기술한 것으로 데이터 사전 (Data Dictionary / System Catalog)에 저장되며 메타 데이터(Meta Data)라고도 합니다.

스키마는 다음과 같이 3계층으로 이뤄졌습니다.



- 개념 스키마
- 외부 스키마
- 내부 스키마



![스키마 계층](https://t1.daumcdn.net/cfile/tistory/2524284758BEDC4127)





### 개념 스키마 (Conceptual Schema)

데이터 베이스의 전체적인 구조를 논리적으로 표현한 것으로

- Entity 간의 관계 및 제약 조건
- 무결성 규칙
- 데이터 베이스 접근 권한 및 보안

등의 명세를 정의합니다.

보통 하나의 데이터 베이스에 대해 **1개만 존재**하며 데이터 베이스에 대한 전체적인 View를 나타냅니다.



단순히 Schema라고 하면 개념 스키마를 의미합니다. ~~(default = ConceptualSchema)~~



### 외부 스키마 (External Schema)

사용자나 개발자 입장에서 논리적으로 데이터 베이스의 구조를 정의한 것



서브 스키마 (Sub Schema)라고도 표현하며, 사용자 View 관점에서의 스키마입니다.



### 내부 스키마 (Internal Schema)

데이터 베이스의 물리적인 구조를 정의한 스키마입니다.

- 데이터의 속성
- 데이터의 저장 크기

등을 기술하고 있습니다.



물리적인 저장 장치와 밀접한 계층으로 시스템 프로그래머나 설계자 관점에서의 스키마입니다.



## 데이터 모델 (Data Model)

### 데이터 모델

현실 세계의 요소를 인간과 컴퓨터가 이해할 수 있는 정보로 표현한 것

### 종류

- 개념적 데이터 모델

  현실 세계의 요소를 인간이 이해할 수 있는 정보 구조로 표현한 것으로, 보통 **E-R(개체-관계) 모델**로 표현

- 논리적 데이터 모델

  개념적 데이터 모델을 컴퓨터가 이해할 수 있도록 변환한 데이터 모델. 일반적으로 **데이터 모델**은 **논리적 데이터 모델**을 의미.

- 물리적 데이터 모델

  논리적 데이터 모델에서 레코드의 상세 스펙 등을 기술한 모델. 실제 컴퓨터에 저장되는 방법을 정의

### 구성 요소

- Entity
- Attribute
- Relationship





## E-R Model

개념적 모델링에 사용되는 데이터 표현 방법으로, Entity와 Entity 간의 Relationship을 나타내는 모델입니다.

![E-R Model 디아로그 예](https://t1.daumcdn.net/cfile/tistory/254EFD4758C97A5606)



### 구성 요소

- Entity

  현실 세계의 요소 중 데이터 베이스에 표현하려는 것

- Attribute

  개체를 구성하는 항목으로 데이터 필드의 역할

- Relationship

  Entity 간의 관계 또는 Attribute 간의 관계를 의미

  - 1:1

  - 1:N

  - N:N

    

    ![Crow-feet 표기법](https://t1.daumcdn.net/cfile/tistory/22695A4D58C979F217))





## 데이터 베이스 설계 순서

**요구 분석 -> 개념적 설계 -> 논리적 설계 - 물리적 설계 - 구현**



1. 요구 조건 분석 / 명세

   데이터 베이스의

   

   - 사용자
   - 사용 목적
   - 사용 범위
   - 제약 조건

   

   등에 대한 내용을 정리하고 명세서를 작성합니다.

2. 개념적 설계 (E-R 모델)

   정보를 구조화 하기 위해 추상적 개념으로 표현하는 과정으로 개념 스키마 모델리오가 트랜잭션 모델링을 병행하고, 요구 조건 분석을 통해 **DBMS 독립**적인 **E-R 다이어그램**을 작성합니다.

3. 논리적 설계 (데이터 모델링)

   자료를 컴퓨터가 이해할 수 있도록 **특정 DBMS**의 논리적 자료 구조로 변환하는 과정.

   RDB는 이 과정에서 **테이블 설계**, **정규화** 과정을 거칩니다.

4. 물리적 설계 (데이터 구조화)

   논리적 구조로 표현된 데이터를 물리적 구조의 데이터로 변환하는 과정입니다.

   데이터 베이스 파일의

   

   - 저장 구조
   - 액세스 경로
   - 인덱스의 구조
   - 저장 레코드의 크기, 순서, 접근 경로

   

   등을 결정하며

   

   - 반응 시간
   - 공간 활용도
   - 트랜잭션 처리량

   

   을 고려하여 설계를 해야합니다.

5. 데이터 베이스 구현

   앞선 설계 단계에서 도출된 데이터 베이스 스키마를 실제 파일로 생성하는 단계입니다.



![설계 순서](https://t1.daumcdn.net/cfile/tistory/2232544E58D145C527)



## RDB의 제약 조건 (Key와 무결성)



RDB(관계형 데이터 베이스)의 제약 조건으로는

- 개체 무결성
- 참조 무결성

이 있습니다. 무결성을 보장하기 위해 RDB에서는 **키(Key)를 이용**하고 있습니다.



![예시](https://t1.daumcdn.net/cfile/tistory/24662F4D58D155A532)



### Key의 종류

Key는 튜플의 유일성을 보장하기 위한 속성(Attribute)을 의미합니다.



1. Candidate Key (후보키)

   튜플의 유일성을 식별할 수 있는 모든 Key

2. Primary Key (기본키)

   튜플의 유일성 확보를 위해 후보키 중에 선택된 Key

3. Alternate Key (대체키)

   두 개 이상의 후보키가 있는 경우 기본키를 제외한 나머지 후보키로 이른 바 보조키를 의미

4. Foreign Key (외래키)

   릴레이션 (Entity, Table) 간의 참조 관계를 나타내기 위한 Key

5. Super Key (슈퍼키)

   릴레이션 내에 있는 속성들의 집합으로 구성된 최소성이 없는 Key



### 데이터 무결성

Data integrity (데이터 무결성)은 데이터의 정확성과 일관성을 유지하고 보증하는 것을 의미합니다.

1. 개체 무결성

   **기본키**와 관련된 것으로 모든 테이블은 기본키를 가져야 하며, 기본키는 고유한 빈 값(Null)이 들어갈 수 없습니다.

2. 참조 무결성

   **외래키**와 관련된 것으로 외래키는 참조 테이블의 기본키 값 또는 Null 값을 가지며, 참조 테이블의 기본키 속성 개수와 도메인이 일치하여야 합니다.





## 데이터 베이스 정규화 개념 및 방법

### 정규화 (DB normalization)

관계형 데이터 베이스 설계 시 중복을 최소화하도록 데이터를 구조화 하는 작업을 정규화라고 하며, 정규화를 하는 이유는 

이상(anomaly)이 있는 관계를 재 구성함으로써 바람직한 스키마로 만들어가는데 있습니다.

![정규화 이미지](https://t1.daumcdn.net/cfile/tistory/223CA34D58DD21FE2B)



### 방법

기본적으로 높은 차수의 정규형은 낮은 차수의 정규형을 모두 만족하여야 한다. 즉, 제 3 정규형은 제 1, 2 정규형의 조건을 모두 만족하여야 하며, BNCF는 1, 2, 3 정규형을 기본적으로 모두 만족하고 있어야합니다.



1. 제 1 정규형 (1NF = 1 Nomal Form)

   중복되는 항목이 없어야 합니다. (도메인이 원자값만으로 되어 있어야 함)

   ![img](https://t1.daumcdn.net/cfile/tistory/2508FC4758DD259E21)

   위와 같이 설계하면 전화번호는 2개 이상일 수 있다. 따라서 전화번호 속성의 도메인에 

   555-861-2025, 511-123-4567

   과 같은 형태의 값이 생깁니다. (도메인이 원자값이 아님) 이는 제 1 정규형을 만족하지 않습니다. 해결하는 방법으로,

   ![img](https://t1.daumcdn.net/cfile/tistory/26136A4C58DD267017)

   위와 같이 할 수 있으나, 다음과 같은 문제가 발생합니다.

   

   - 갯수 제한 : 어떤 고객이 4개의, N개의 전화번호를 가지고 있다면?
   - 테이블 질의 어려움 : 어떤 고객이 555-403-1659 전화번호를 가지고 있는가?
   - 고객/전화번호 간의 유일성 확보가 안됨 : 465 고객의 전화번호 2개가 중복으로 들어가있다.

   

   따라서, 이를 해결하려면 다음과 같이 해야합니다.

   ![제 1 정규형 답](https://t1.daumcdn.net/cfile/tistory/2577694C58DD28990D)

   

2. 제 2 정규형 (2NF)

   부분 함수적 종속 관계를 제거해야 합니다.

   

   ![제 2 정규형 문제](https://t1.daumcdn.net/cfile/tistory/2449AE4858DD38BC2E)

   

   위 테이블에서 **후보키(기본키의 후보가 될 수 있는 키)**는 "종업원 + 기술"입니다. 그런데 근무지는 종업원에만 종속적인 관계를 갖습니다. 이처럼 키의 일부에만 종석적인 관계를 가지는 것을 **부분 함수적 종속관계**라 하며, 이는 갱신이상 현상을 초래할 수 있습니다. 따라서,

   

   ![제 2 정규형 답](https://t1.daumcdn.net/cfile/tistory/274E744858DD38BD14)

   

   

3. 제 3 정규형 (3NF)

   이행 함수적 종속(x-> y-> z) 제거

   ![제 3 정규형 문제](https://t1.daumcdn.net/cfile/tistory/236D584858DD39B809)

   

   위 테이블에서 대회 + 연도의 키로 우승자가 결정되고 우승자에 따라 우승자 생년월일이 결정됩니다. 이처럼 x -> y이고,       y -> z인 관계를 **이행 함수적 종속**이라고 합니다.  이런 경우 우승자를 변경하면 불필요하게 우승자 생년월일도 동시에 변경해야 하기 때문에 갱신 이상 현상을 초래할 수 있습니다. 이를 해결하려면,

   

   ![제 3규형 답](https://t1.daumcdn.net/cfile/tistory/2727914858DD39B929)

   

   위처럼 테이블을 분리해서 해결합니다. 대부분의 99%의 정규형 작업이 여기서 끝난다고 보시면 됩니다. 따라서 다음 정규화 작업은 추후에 검토해보도록 합니다.

   

4. BC(Boyce-codd) 정규형 (BCNF)

   결정자이면서 후보키가 아닌 것 제거

5. 제 4 정규형

   다치 종속 제거

6. 제 5 정규형

   조인 종속성 이용





## 관계 대수, 관계 해석

### 관계 대수 (relational algebra)

관계형 DB에서 원하는 정보를 검색하기 위해서 어떻게 유도할지를 기술한 **절차적 언어**입니다.

연산자와 연산 규칙을 제공하며, 질의에 대한 해를 구하기 위해 수행해야할 연산의 순서를 명시합니다. (절차적 성격)



- 순수 관계 연산자
  - Select
  - Project
  - Join(Equi, Natural)
  - Division
- 일반 집합 연산자
  - UNION (합집합)
  - INTERSECTION (교집합)
  - DIFFERNCE (차집합)
  - CARTESIAN PRODUCT (교차곱)



![연산자 목록 1](https://t1.daumcdn.net/cfile/tistory/236EF04B58E39BB311)

![연산자 목록 2](https://t1.daumcdn.net/cfile/tistory/2547764B58E39BB416)



### 관계 해석 (relational calculus)

원하는 정보가 무엇이라는 것 만 정의하는 **비절차적**특징을 갖는다. SQL문과 같은 **질의어를 사용**하며 튜플 관계 해석과 도메인 해석으로 구성된다.



### 비교

관계 대수로 표현한 식은 관계 해석으로도 표현 가능합니다.

관계 해석과 관계 대수는 관계형 DB를 처리하는 기능과 능력면에서는 동등합니다.





출처 : [곰씨네 블로그](https://gomcine.tistory.com/category/Study/Database), [개발자를 꿈꾸는 프로그래머](https://jwprogramming.tistory.com/52)

